(()=>{"use strict";var t={d:(e,n)=>{for(var o in n)t.o(n,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:n[o]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};function e(){return fetch("https://nomoreparties.co/v1/wff-cohort-40/users/me",{headers:{authorization:"7e118dfc-cae6-4af0-96ac-0800487ee4ed","Content-Type":"application/json"}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))}function n(t,e,n,o,r,a,i){var c=e.querySelector(".card").cloneNode(!0),u=c.querySelector(".card__delete-button"),s=c.querySelector(".card__like-button"),l=c.querySelector(".card__image"),p=t._id,d=c.querySelector(".card__like-count");return d.textContent=t.likes.length,t.likes.some((function(t){return t._id===i._id}))&&s.classList.add("card__like-button_is-active"),Object.assign(l,{src:t.link,alt:t.name}),c.querySelector(".card__title").textContent=t.name,t.owner._id===i._id?u.addEventListener("click",(function(){r(c,t,i)})):u.remove(),s.addEventListener("click",(function(){a(s,p,d)})),l.addEventListener("click",(function(){o(t)})),c.id="card-".concat(t._id),c}function o(t,e,n){var o;e.owner._id===n._id&&(o=e._id,fetch("https://nomoreparties.co/v1/wff-cohort-40/cards/".concat(o),{method:"DELETE",headers:{authorization:I.authorizationToken,"Content-Type":"application/json"}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))).then((function(){t.remove()})).catch((function(t){console.error("Ошибка удаления карточки:",t)}))}function r(t,e,n){var o;t.classList.contains("card__like-button_is-active")?(o=e,fetch("https://nomoreparties.co/v1/wff-cohort-40/cards/likes/".concat(o),{method:"DELETE",headers:{authorization:I.authorizationToken,"Content-Type":"application/json"}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))).then((function(e){n.textContent=e.likes.length,t.classList.remove("card__like-button_is-active")})).catch((function(t){return console.error("Ошибка при удалении лайка:",t)})):function(t){return fetch("https://nomoreparties.co/v1/wff-cohort-40/cards/likes/".concat(t),{method:"PUT",headers:{authorization:I.authorizationToken,"Content-Type":"application/json"}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))}(e).then((function(e){n.textContent=e.likes.length,t.classList.add("card__like-button_is-active")})).catch((function(t){return console.error("Ошибка при добавлении лайка:",t)}))}function a(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",c),t.addEventListener("click",u)}function i(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",c),t.removeEventListener("click",u)}function c(t){"Escape"===t.key&&document.querySelector(".popup_is-opened")&&i(document.querySelector(".popup_is-opened"))}function u(t){t.target===t.currentTarget&&i(t.target.closest(".popup"))}function s(t,e,n){var o=t.querySelector(".".concat(e.name,"-error"));e.classList.remove(n.inputErrorClass),o.classList.remove("popup__input-error_active"),o.textContent=""}function l(t,e,n){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?(e.classList.remove(n.inactiveButtonClass),e.disabled=!1):(e.classList.add(n.inactiveButtonClass),e.disabled=!0)}function p(t,e){Array.from(t.querySelectorAll(e.inputSelector)).forEach((function(n){s(t,n,e)}))}function d(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=Array(e);n<e;n++)o[n]=t[n];return o}t.d({},{D:()=>I});var f=document.querySelector.bind(document),_=f(".places__list"),m=f("#card-template").content,h=(document.querySelector(".popup"),f(".popup_type_image")),v=f(".popup_type_new-card"),y=f(".popup_type_edit"),k=f(".popup_type_new-avatar"),b=f(".profile__edit-button"),S=f(".profile__add-button"),E=document.querySelectorAll(".popup__close"),g=f('form[name="edit-profile"]'),C=g.querySelector(".popup__input_type_name"),L=g.querySelector(".popup__input_type_description"),j=f('form[name="new-place"]'),q=j.querySelector(".popup__input_type_card-name"),w=j.querySelector(".popup__input_type_url"),T=f('form[name="new-avatar"]'),A=f(".popup__input_type_url-avatar"),x=f(".profile__image"),z=f(".profile__title"),P=f(".profile__description"),O=h.querySelector(".popup__image"),D=h.querySelector(".popup__caption"),B={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"button_inactive",inputErrorClass:"popup__input_type_error",inputErrorActive:".popup__input-error_active"},I={authorizationToken:"7e118dfc-cae6-4af0-96ac-0800487ee4ed"};function M(t){Object.assign(O,{src:t.link,alt:t.name}),D.textContent=t.name,a(h)}!function(t){Array.from(document.querySelectorAll(t.formSelector)).forEach((function(e){e.addEventListener("submit",(function(t){t.preventDefault()})),function(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),o=t.querySelector(e.submitButtonSelector);l(n,o,e),n.forEach((function(r){r.addEventListener("input",(function(){!function(t,e,n){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?s(t,e,n):function(t,e,n,o){var r=t.querySelector(".".concat(e.name,"-error"));e.classList.add(o.inputErrorClass),r.classList.add("popup__input-error_active"),r.textContent=n}(t,e,e.validationMessage,n),l(Array.from(t.querySelectorAll(n.inputSelector)),t.querySelector(n.submitButtonSelector),n)}(t,r,e),l(n,o,e)}))}))}(e,t)}))}(B),Promise.all([fetch("https://nomoreparties.co/v1/wff-cohort-40/cards ",{headers:{authorization:I.authorizationToken}}).then((function(t){if(t.ok)return t.json()})).then((function(t){return t})).catch((function(t){console.log(t)})),e()]).then((function(t){var e,a,i=(a=2,function(t){if(Array.isArray(t))return t}(e=t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var o,r,a,i,c=[],u=!0,s=!1;try{if(a=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(o=a.call(n)).done)&&(c.push(o.value),c.length!==e);u=!0);}catch(t){s=!0,r=t}finally{try{if(!u&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(s)throw r}}return c}}(e,a)||function(t,e){if(t){if("string"==typeof t)return d(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?d(t,e):void 0}}(e,a)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),c=i[0],u=i[1];!function(t,e){t.forEach((function(t){var a=n(t,m,0,M,o,r,e);_.append(a)}))}(c,u),z.textContent=u.name,P.textContent=u.about})).catch((function(t){console.log(t)})),window.addEventListener("load",(function(){e().then((function(t){t.avatar&&x&&(x.style.backgroundImage="url(".concat(t.avatar,")")),z.textContent=t.name,P.textContent=t.about})).catch((function(t){console.log(t)}))})),T.addEventListener("submit",(function(t){var e;t.preventDefault(),(e=A.value,fetch("https://nomoreparties.co/v1/wff-cohort-40/users/me/avatar",{method:"PATCH",headers:{authorization:I.authorizationToken,"Content-Type":"application/json"},body:JSON.stringify({avatar:e})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))).then((function(t){x&&(x.style.backgroundImage="url(".concat(t.avatar,")"))})),i(k)})),E.forEach((function(t){t.addEventListener("click",(function(){var e=t.closest(".popup");e&&i(e)}))})),j.addEventListener("submit",(function(t){var e;t.preventDefault(),(e={name:q.value,link:w.value},fetch("https://nomoreparties.co/v1/wff-cohort-40/cards",{method:"POST",headers:{authorization:I.authorizationToken,"Content-Type":"application/json"},body:JSON.stringify(e)}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))).then((function(t){var e=n(t,m,0,M,o,r,t.owner);_.prepend(e)})).catch((function(t){console.log(t)})),i(f(".popup_is-opened")),j.reset()})),b.addEventListener("click",(function(){a(y),C.value=z.textContent,L.value=P.textContent,p(g,B)})),S.addEventListener("click",(function(){a(v),j.reset(),p(j,B)})),x.addEventListener("click",(function(){a(k),j.reset(),p(j,B)})),g.addEventListener("submit",(function(t){var e,n;t.preventDefault(),(e=C.value,n=L.value,fetch("https://nomoreparties.co/v1/wff-cohort-40/users/me",{method:"PATCH",headers:{authorization:I.authorizationToken,"Content-Type":"application/json"},body:JSON.stringify({name:e,about:n})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))).then((function(t){z.textContent=t.name,P.textContent=t.about,i(y)})).catch((function(t){console.log(t)}))}))})();