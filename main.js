(()=>{"use strict";var t={d:(e,n)=>{for(var o in n)t.o(n,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:n[o]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};function e(){return fetch("https://nomoreparties.co/v1/wff-cohort-40/users/me",{headers:{authorization:"7e118dfc-cae6-4af0-96ac-0800487ee4ed","Content-Type":"application/json"}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))}function n(t,e,n,o,r,i,a){var c=e.querySelector(".card").cloneNode(!0),u=c.querySelector(".card__delete-button"),s=c.querySelector(".card__like-button"),l=c.querySelector(".card__image"),p=t._id,d=c.querySelector(".card__like-count");return d.textContent=t.likes.length,t.likes.some((function(t){return t._id===a._id}))&&s.classList.add("card__like-button_is-active"),Object.assign(l,{src:t.link,alt:t.name}),c.querySelector(".card__title").textContent=t.name,t.owner._id===a._id?u.addEventListener("click",(function(){r(c,t,a)})):u.remove(),s.addEventListener("click",(function(){i(s,p,d)})),l.addEventListener("click",(function(){o(t)})),c.id="card-".concat(t._id),c}function o(t,e,n){var o;e.owner._id===n._id&&(o=e._id,fetch("https://nomoreparties.co/v1/wff-cohort-40/cards/".concat(o),{method:"DELETE",headers:{authorization:M.authorizationToken,"Content-Type":"application/json"}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))).then((function(){t.remove()})).catch((function(t){console.error("Ошибка удаления карточки:",t)}))}function r(t,e,n){var o;t.classList.contains("card__like-button_is-active")?(o=e,fetch("https://nomoreparties.co/v1/wff-cohort-40/cards/likes/".concat(o),{method:"DELETE",headers:{authorization:M.authorizationToken,"Content-Type":"application/json"}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))).then((function(e){n.textContent=e.likes.length,t.classList.remove("card__like-button_is-active")})).catch((function(t){return console.error("Ошибка при удалении лайка:",t)})):function(t){return fetch("https://nomoreparties.co/v1/wff-cohort-40/cards/likes/".concat(t),{method:"PUT",headers:{authorization:M.authorizationToken,"Content-Type":"application/json"}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))}(e).then((function(e){n.textContent=e.likes.length,t.classList.add("card__like-button_is-active")})).catch((function(t){return console.error("Ошибка при добавлении лайка:",t)}))}function i(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",c),t.addEventListener("click",u)}function a(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",c),t.removeEventListener("click",u)}function c(t){"Escape"===t.key&&document.querySelector(".popup_is-opened")&&a(document.querySelector(".popup_is-opened"))}function u(t){t.target===t.currentTarget&&a(t.target.closest(".popup"))}function s(t,e,n){var o=t.querySelector(".".concat(e.name,"-error"));e.classList.remove(n.inputErrorClass),o.classList.remove("popup__input-error_active"),o.textContent=""}function l(t,e,n){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?(e.classList.remove(n.inactiveButtonClass),e.disabled=!1):(e.classList.add(n.inactiveButtonClass),e.disabled=!0)}function p(t,e){Array.from(t.querySelectorAll(e.inputSelector)).forEach((function(n){s(t,n,e)}))}function d(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=Array(e);n<e;n++)o[n]=t[n];return o}t.d({},{D:()=>M});var f=document.querySelector.bind(document),_=f(".places__list"),h=f("#card-template").content,m=(document.querySelector(".popup"),f(".popup_type_image")),v=f(".popup_type_new-card"),y=f(".popup_type_edit"),b=f(".popup_type_new-avatar"),k=f(".profile__edit-button"),S=f(".profile__add-button"),C=document.querySelectorAll(".popup__close"),g=f(".popup__button"),E=f('form[name="edit-profile"]'),L=E.querySelector(".popup__input_type_name"),j=E.querySelector(".popup__input_type_description"),q=f('form[name="new-place"]'),w=q.querySelector(".popup__input_type_card-name"),T=q.querySelector(".popup__input_type_url"),x=f('form[name="new-avatar"]'),A=f(".popup__input_type_url-avatar"),z=f(".profile__image"),P=f(".profile__title"),O=f(".profile__description"),D=m.querySelector(".popup__image"),B=m.querySelector(".popup__caption"),I={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"button_inactive",inputErrorClass:"popup__input_type_error",inputErrorActive:".popup__input-error_active"},M={authorizationToken:"7e118dfc-cae6-4af0-96ac-0800487ee4ed"};function N(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Сохранить";t?(e.textContent="Сохранение...",e.disabled=!0):(e.textContent=n,e.disabled=!1)}function J(t){Object.assign(D,{src:t.link,alt:t.name}),B.textContent=t.name,i(m)}!function(t){Array.from(document.querySelectorAll(t.formSelector)).forEach((function(e){e.addEventListener("submit",(function(t){t.preventDefault()})),function(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),o=t.querySelector(e.submitButtonSelector);l(n,o,e),n.forEach((function(r){r.addEventListener("input",(function(){!function(t,e,n){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?s(t,e,n):function(t,e,n,o){var r=t.querySelector(".".concat(e.name,"-error"));e.classList.add(o.inputErrorClass),r.classList.add("popup__input-error_active"),r.textContent=n}(t,e,e.validationMessage,n),l(Array.from(t.querySelectorAll(n.inputSelector)),t.querySelector(n.submitButtonSelector),n)}(t,r,e),l(n,o,e)}))}))}(e,t)}))}(I),Promise.all([fetch("https://nomoreparties.co/v1/wff-cohort-40/cards ",{headers:{authorization:M.authorizationToken}}).then((function(t){if(t.ok)return t.json()})).then((function(t){return t})).catch((function(t){console.log(t)})),e()]).then((function(t){var e,i,a=(i=2,function(t){if(Array.isArray(t))return t}(e=t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var o,r,i,a,c=[],u=!0,s=!1;try{if(i=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(o=i.call(n)).done)&&(c.push(o.value),c.length!==e);u=!0);}catch(t){s=!0,r=t}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(s)throw r}}return c}}(e,i)||function(t,e){if(t){if("string"==typeof t)return d(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?d(t,e):void 0}}(e,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),c=a[0],u=a[1];!function(t,e){t.forEach((function(t){var i=n(t,h,0,J,o,r,e);_.append(i)}))}(c,u),P.textContent=u.name,O.textContent=u.about})).catch((function(t){console.log(t)})),window.addEventListener("load",(function(){e().then((function(t){t.avatar&&z&&(z.style.backgroundImage="url(".concat(t.avatar,")")),P.textContent=t.name,O.textContent=t.about})).catch((function(t){console.log(t)}))})),x.addEventListener("submit",(function(t){var e;t.preventDefault(),N(!0,g),(e=A.value,fetch("https://nomoreparties.co/v1/wff-cohort-40/users/me/avatar",{method:"PATCH",headers:{authorization:M.authorizationToken,"Content-Type":"application/json"},body:JSON.stringify({avatar:e})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))).then((function(t){z&&(z.style.backgroundImage="url(".concat(t.avatar,")"))})).finally((function(){N(!1,g)})),a(b)})),C.forEach((function(t){t.addEventListener("click",(function(){var e=t.closest(".popup");e&&a(e)}))})),q.addEventListener("submit",(function(t){var e;t.preventDefault(),N(!0,g),(e={name:w.value,link:T.value},fetch("https://nomoreparties.co/v1/wff-cohort-40/cards",{method:"POST",headers:{authorization:M.authorizationToken,"Content-Type":"application/json"},body:JSON.stringify(e)}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))).then((function(t){var e=n(t,h,0,J,o,r,t.owner);_.prepend(e)})).catch((function(t){console.log(t)})).finally((function(){N(!1,g)})),a(f(".popup_is-opened")),q.reset()})),k.addEventListener("click",(function(){i(y),L.value=P.textContent,j.value=O.textContent,p(E,I)})),S.addEventListener("click",(function(){i(v),q.reset(),p(q,I)})),z.addEventListener("click",(function(){i(b),q.reset(),p(q,I)})),E.addEventListener("submit",(function(t){var e,n;t.preventDefault(),N(!0,g),(e=L.value,n=j.value,fetch("https://nomoreparties.co/v1/wff-cohort-40/users/me",{method:"PATCH",headers:{authorization:M.authorizationToken,"Content-Type":"application/json"},body:JSON.stringify({name:e,about:n})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))).then((function(t){P.textContent=t.name,O.textContent=t.about,a(y)})).catch((function(t){console.log(t)})).finally((function(){N(!1,g)}))}))})();